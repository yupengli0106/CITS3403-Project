<html lang="en">
	<head>
		<title>register</title>
		<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css"/>
		<script type="text/javascript" src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
		<script type="text/javascript" src="/static/bootstrap/js/bootstrap.min.js"></script>
		<style type="text/css">
			.login_box{
				width: 350px;
				height: 200px;
				margin: 200px auto;
			}
			.form-control{
				width: 170px;
				margin-left: 20px;
			}

		</style>
	</head>
	<body>
		<!-- modal -->
		<div class="modal fade" id="profile" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-body">
						Are you sure you want to delete your account (all your data will be erased)!?
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal" id="no">Cancel</button>
						<button type="button" class="btn btn-secondary" data-dismiss="modal" id="yes">Yes!</button>
					</div>
				</div>
			</div>
		</div> 
		<!-- form -->
		<div class="login_box">
			<form class="form-horizontal">
		  		<div class="form-group">
		    		<label for="username" class="col-sm-2 control-label">new username</label>
		    		<div class="col-sm-10">
		    			<input type="text" class="form-control" id="username" placeholder="username">
	    			</div>
	  			</div>
	  			<div class="form-group">
	    			<label for="password" class="col-sm-2 control-label">new password</label>
	    			<div class="col-sm-10">
	      				<input type="password" class="form-control" id="password" placeholder="password">
	    			</div>
	  			</div>
	  			<div class="form-group">
	    			<label for="password2" class="col-sm-2 control-label">confirm password</label>
	    			<div class="col-sm-10">
	      				<input type="password" class="form-control" id="password2" placeholder="password">
	    			</div>
	  			</div>
	  			<div class="form-group">
	    			<div class="col-sm-offset-2 col-sm-10">
	      				<button id="submit" type="submit" class="btn btn-default">Update</button>
                        <button id="delete" type="submit" class="btn btn-default">Delete Account?</button>
	    			</div>
	  			</div>
			</form>
		</div>
	</body>
</html>
<script type="text/javascript">
	$(document).ready(function(){
        // update username and password
		$("#submit").click(function(){
			event.preventDefault();
			var username = $("#username").val().trim();
			var password = $("#password").val().trim();
			var password2 = $("#password2").val().trim();
			if(username.length > 20){
				alert("The length of the user name cannot over 20 characters");
				return;
			}
			if(username.length == 0){
				alert("Please input username");
				return;
			}
			if(password.length == 0){
				alert("Please input password");
				return;
			}
			if(password != password2){
				alert("The two passwords are inconsistent");
				return;
			}
            
			$.ajax({
				url: '/update',
				type: 'POST',
				dataType: 'json',
				data: {'username': username, 'password': password},
				success: function(data, textStatus, xhr) {
					if(data.status == "success"){
                        alert("Proflie update successful, please login again!");
						window.location.href = "/login";
					}else{
						alert('username already exists');
					}
				},
				error: function(xhr, textStatus, errorThrown) {
				//called when there is an error
				}
			});
		});
        // delete user account
        $("#delete").click(function(){
            event.preventDefault();
            $("#profile").modal('show');
        });
        $("#yes").click(function(){
            $.ajax({
                url: '/delete',
                type: 'POST',
                dataType: 'json',
                success: function(data, textStatus, xhr) {
                    if(data.status == "success"){
                        alert("Your account has been deleted, thank you for using our service!");
                        window.location.href = "/login";
                    }else{
                        alert('delete failed');
                    }
                },
                error: function(xhr, textStatus, errorThrown) {
                //called when there is an error
                }
            });
        });
        $("#no").click(function(){
            $("#profile").modal('hide');
        }); // end of delete button
	});
</script>